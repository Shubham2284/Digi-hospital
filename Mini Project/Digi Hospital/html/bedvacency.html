<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TejasVi</title>
    <link rel="stylesheet" href="../css/bedvacency.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
</head>

<body>

    <div class="main-div">
        <header class="header">
            <img src="../media/images/bedbanner.jpeg" alt="Delhi State Health Data Management Portal">
            <div class="header-msg">
                <p> Hospital ICU Beds Dashboard - Health & family Welfare Department, GNCT of Delhi</p>
            </div>
        </header>
        <main>
            <div class="input-fields">
                <div class="dropdown-container">
                    <button class="dropdown-button" id="dropdownBtn">District Name</button>
                    <div class="dropdown-content" id="dropdownContent">
                        <label><input type="checkbox" class="district-checkbox" id="selectAll"> Select All</label>
                        <input type="text" class="dropdown-search" id="searchInput" placeholder="Search...">
                        <label><input type="checkbox" class="district-checkbox" value="Central"> Central</label>
                        <label><input type="checkbox" class="district-checkbox" value="East"> East</label>
                        <label><input type="checkbox" class="district-checkbox" value="New Delhi"> New Delhi</label>
                        <label><input type="checkbox" class="district-checkbox" value="North"> North</label>
                        <label><input type="checkbox" class="district-checkbox" value="North East"> North East</label>
                        <label><input type="checkbox" class="district-checkbox" value="North West"> North West</label>
                        <label><input type="checkbox" class="district-checkbox" value="Shahdara"> Shahdara</label>
                        <label><input type="checkbox" class="district-checkbox" value="South East"> South East</label>
                        <label><input type="checkbox" class="district-checkbox" value="South West"> South West</label>
                        <label><input type="checkbox" class="district-checkbox" value="West"> West</label>
                    </div>
                </div>
                <div class="dropdown-container">
                    <button class="dropdown-button" id="dropdownBtn1">Hospital</button>
                    <div class="dropdown-content" id="dropdownContent1">
                        <label><input type="checkbox" class="hospital-checkbox" id="selectAll"> Select All</label>
                        <input type="text" class="dropdown-search" id="searchInput1" placeholder="Search...">
                        <label><input type="checkbox" class="hospital-checkbox" value="Central"> Central</label>
                        <label><input type="checkbox" class="hospital-checkbox" value="East"> East</label>
                        <label><input type="checkbox" class="hospital-checkbox" value="New Delhi"> New Delhi</label>
                        <label><input type="checkbox" class="hospital-checkbox" value="North"> North</label>
                        <label><input type="checkbox" class="hospital-checkbox" value="North East"> North East</label>
                        <label><input type="checkbox" class="hospital-checkbox" value="North West"> North West</label>
                        <label><input type="checkbox" class="hospital-checkbox" value="Shahdara"> Shahdara</label>
                        <label><input type="checkbox" class="hospital-checkbox" value="South East"> South East</label>
                        <label><input type="checkbox" class="hospital-checkbox" value="South West"> South West</label>
                        <label><input type="checkbox" class="hospital-checkbox" value="West"> West</label>
                    </div>
                </div>
                <div class="dropdown-container">
                    <button class="dropdown-button" id="dropdownBtn2">Speciality</button>
                    <div class="dropdown-content" id="dropdownContent2">
                        <label><input type="checkbox" class="special-checkbox" id="selectAll"> Select All</label>
                        <input type="text" class="dropdown-search" id="searchInput2" placeholder="Search...">
                        <label><input type="checkbox" class="special-checkbox" value="Central"> Central</label>
                        <label><input type="checkbox" class="special-checkbox" value="East"> East</label>
                        <label><input type="checkbox" class="special-checkbox" value="New Delhi"> New Delhi</label>
                        <label><input type="checkbox" class="special-checkbox" value="North"> North</label>
                        <label><input type="checkbox" class="special-checkbox" value="North East"> North East</label>
                        <label><input type="checkbox" class="special-checkbox" value="North West"> North West</label>
                        <label><input type="checkbox" class="special-checkbox" value="Shahdara"> Shahdara</label>
                        <label><input type="checkbox" class="special-checkbox" value="South East"> South East</label>
                        <label><input type="checkbox" class="special-checkbox" value="South West"> South West</label>
                        <label><input type="checkbox" class="special-checkbox" value="West"> West</label>
                    </div>
                </div>
            </div>
            <div class="info">
                <p>ICU bed vacancy</p>
                <div class="info-block1 box">
                    <p>More than 10 beds</p>
                </div>
                <div class="info-block2 box">
                    <p>5 to 10 beds</p>
                </div>
                <div class="info-block3 box">
                    <p>less than 5 beds</p>
                </div>
            </div>
            <div class="list">

                <div class="table-container">
                    <table style="border: 1;" cellpadding="10" cellspacing="0">
                        <thead>
                            <tr>
                                <th>S.no</th>
                                <th>Name of Hospital</th>
                                <th>District Name</th>
                                <th>Speciality</th>
                                <th>Helpline Number</th>
                                <th>Last Updated</th>
                                <th>Total Beds</th>
                                <th>Total ICU Beds Vacant</th>
                                <th>Total General Beds Vacant</th>
                                <th>Total Private Beds Vacant</th>
                                <th>Blood Test Labs</th>
                                <th>Testing Machines</th>
                                <th>Direction</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Rows will be dynamically populated here -->
                        </tbody>
                    </table>
                </div>

            </div>

        </main>
    </div>



</body>
<script src="../javascript/bedvacency.js"></script>
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
    import { getDatabase, ref, get, onValue } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDox-bH1UMvQvvzYhlx2T9R6felaN_O_sM",
        authDomain: "miniproject-646ed.firebaseapp.com",
        projectId: "miniproject-646ed",
        storageBucket: "miniproject-646ed.appspot.com",
        messagingSenderId: "463097341157",
        appId: "1:463097341157:web:789479a051d00de852200c"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const tableBody = document.querySelector('table tbody');

    // Function to insert the live data from the 'beds' dataset
    function insertLiveHospitalData(data) {
        const {
            Sno, Name_of_Hospital, District_Name, Speciality, Helpline_Number,
            Last_Updated, general, icu, private: priv, semiprivate,
            Blood_Test_Labs, Testing_Machines, Direction
        } = data;

        // Creating the new row for the first position
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${Sno}</td>
            <td>${Name_of_Hospital}</td>
            <td>${District_Name}</td>
            <td>${Speciality}</td>
            <td>${Helpline_Number}</td>
            <td>${Last_Updated}</td>
            <td>${general.total + icu.total + priv.total + semiprivate.total}</td>
            <td>${icu.remaining}</td>
            <td>${general.remaining}</td>
            <td>${priv.remaining}</td>
            <td>${Blood_Test_Labs}</td>
            <td>${Testing_Machines.join(', ')}</td>
            <td>
                <a href="${Direction}" target="_blank">
                    <i class="fa fa-map-marker" style="font-size:24px; color:red;"></i>
                </a>
            </td>
        `;

        // Insert at the first position
        tableBody.insertBefore(row, tableBody.firstChild);
    }

    // Load all hospital records from the 'otherhspdata/hospitaldata' set
    function loadHospitalData() {
        const hospitalRef = ref(db, 'otherhspdata/hospitaldata');
        get(hospitalRef).then((snapshot) => {
            if (snapshot.exists()) {
                const hospitalData = snapshot.val();
                populateHospitalTable(hospitalData);
            } else {
                console.error("No hospital data found.");
            }
        }).catch((error) => {
            console.error("Error loading hospital data:", error);
        });
    }

    // Populate the rest of the table with hospital records
    function populateHospitalTable(data) {
        Object.values(data).forEach((hospital) => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${hospital.Sno}</td>
                <td>${hospital.Name_of_Hospital}</td>
                <td>${hospital.District_Name}</td>
                <td>${hospital.Speciality}</td>
                <td>${hospital.Helpline_Number}</td>
                <td>${hospital.Last_Updated}</td>
                <td>${hospital.Total_Beds}</td>
                <td>${hospital.Total_ICU_Beds_Vacant}</td>
                <td>${hospital.Total_General_Beds_Vacant}</td>
                <td>${hospital.Total_Private_Beds_Vacant}</td>
                <td>${hospital.Blood_Test_Labs}</td>
                <td>${hospital.Testing_Machines.join(', ')}</td>
                <td>
                    <a href="${hospital.Direction}" target="_blank">
                        <i class="fa fa-map-marker" style="font-size:24px; color:red;"></i>
                    </a>
                </td>
            `;
            tableBody.appendChild(row);
        });
    }

    // Real-time listener for bed data updates
    function loadAndMonitorBedData() {
        const bedRef = ref(db, 'beds');

        // Listening for real-time updates
        onValue(bedRef, (snapshot) => {
            if (snapshot.exists()) {
                const bedData = snapshot.val();
                console.log("Live Bed Data:", bedData);

                // Insert or update the first row with the latest bed data
                insertLiveHospitalData(bedData); // Insert the live hospital data here
            } else {
                console.error("No bed data found.");
            }
        }, (error) => {
            console.error("Error fetching bed data:", error);
        });
    }

    // Initialize both hospital and bed data loading
    window.addEventListener('DOMContentLoaded', () => {
        loadAndMonitorBedData();   // Load and monitor bed data in real-time
        loadHospitalData();   // Load other hospital records
    });
</script>




</html>